<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>K 스케줄 - 한화이글스 에디션</title>
    <style>
      /* 1. 폰트 등록 */
      @font-face {
        font-family: "Eagles-Bold";
        src: url("Fonts/HanwhaEagles-Regular.ttf") format("truetype");
        font-weight: normal;
      }
      @font-face {
        font-family: "Eagles-Gothic";
        src: url("Fonts/06HANWHAGOTHICL.TTF") format("truetype");
        font-weight: normal;
      }

      /* 2. 전체 레이아웃 */
      body {
        margin: 0;
        padding: 8px;
        background-color: #f5f5f7;
        font-family: "Eagles-Gothic", sans-serif;
        -webkit-font-smoothing: antialiased;
        position: relative; /* 유니폼 배치를 위해 추가 */
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        position: relative;
      }

      /* 3. 우측 상단 유니폼 사진 */
      .uniform-container {
        position: absolute;
        top: 0;
        right: 0px;
        width: 143px; /* 사진 크기 */
        z-index: 10;
        text-align: right;
      }
      #uniform-img {
        max-width: 100%;
        height: auto;
        display: none; /* 데이터 매칭 전엔 숨김 */
        filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.15));
      }

      /* 4. 상단 헤더 컨테이너 */
      .schedule-header-container {
        margin-bottom: 15px;
        padding: 5px 5px;
        border-left: 6px solid rgb(252, 78, 0);
      }

      .main-title {
        font-family: "Eagles-Bold", sans-serif;
        font-size: 2.8rem;
        color: rgb(28, 30, 60);
        margin: 0;
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      /* 5. 갱신 버튼 스타일 (크게 수정됨) */
      .status-btn {
        cursor: pointer;
        border: none;
        border-radius: 50px;
        padding: 12px 120px; /* 패딩 조정 */
        font-family: "Eagles-Bold", sans-serif;
        font-size: 2rem; /* 폰트 크기 */
        transition: all 0.3s ease;
        background-color: #e0e0e0;
        color: #666;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .status-btn.updated {
        background-color: rgb(252, 78, 0);
        color: white;
        box-shadow: 0 4px 15px  rgb(28, 30, 60);
      }

      .tomorrow-badge {
        background-color: #333;
        color: white;
        font-size: 1rem;
        padding: 5px 10px;
        border-radius: 50px;
        border: 1px solid rgb(252, 78, 0);
      }

      .weather-info {
        font-size: 1.1rem;
        color: #666;
        margin-top: 5px;
      }
      .weather-tag {
        background-color: #eee;
        padding: 3px 10px;
        border-radius: 4px;
        margin-right: 5px;
      }

      /* 4. 표 스타일 - 화면 높이에 맞게 가변 설정 */
      #display {
        height: 70%; /* 화면 높이의 약 70%를 표가 차지하도록 설정 */
        display: flex;
      }

      table {
        width: 100%;
        height: 100%; /* 부모(#display) 높이를 가득 채움 */
        border-collapse: collapse;
        table-layout: fixed;
        background: white;
      }

      td {
        border: 1px solid #444;
        padding: 3px;
        text-align: center;
        font-size: 1.2rem;
        /* 핵심: 행이 적으면 높이를 늘리고, 많으면 줄어들게 함 */
        height: auto;
      }

      /* 제목 행(투수/야수)은 너무 늘어나지 않게 적당한 높이 유지 */
      .main-header {
        height: 60px;
        font-family: "Eagles-Bold", sans-serif;
        background-color: rgb(252, 78, 0);
        color: rgb(28, 30, 60);
        font-size: 2.3rem;
      }

      .col-time {
        background-color: rgb(235, 235, 235);
        font-weight: bold;
      }
      .col-content {
        text-align: left;
        padding-left: 20px;
      }
      .center-line {
        border-right: 3px solid #333 !important;
      }
      .player-list-cell {
        background-color: rgb(240, 240, 240);
        letter-spacing: 2px;
      }

      /* style.css 또는 <style> 태그 안에 추가 */
.weather-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    margin: 5px;
}

.min-max {
    font-size: 0.85rem;
    color: #ddd; /* 약간 흐리게 해서 현재 기온과 구분 */
    margin-top: 2px;
}

.temp strong {
    font-size: 1.2rem;
    color: #ff6600; /* 한화 오렌지색 포인트! */
}
    </style>
  </head>
  <body>
    <div class="container">
      <div class="uniform-container">
        <img id="uniform-img" src="" alt="Today Uniform" />
      </div>

      <div class="schedule-header-container">
        <h1 class="main-title">
          <span id="date-text">SCHEDULE</span>
          <span id="badge-area"></span>
          <button id="update-btn" class="status-btn" onclick="toggleStatus()">
            스케줄 갱신 전
          </button>
        </h1>
        <div id="weather-display" class="weather-info">
          서산 날씨 확인 중...
        </div>
      </div>

      <div id="display"></div>
    </div>

    <script>
      function toggleStatus() {
        const btn = document.getElementById("update-btn");
        btn.classList.toggle("updated");
        btn.innerText = btn.classList.contains("updated")
          ? "내일 스케줄로 갱신 됨 ✓"
          : "스케줄 갱신 전";
      }

      async function updateWeatherOnly() {
  const weatherDisplay = document.getElementById('weather-display');
  const API_KEY = 'cbdcecd908e8704e65f974ca31c52b4e';
  
  // 서산과 고베 두 곳의 날씨를 가져옵니다
  const cities = [
    { name: '서산', id: 'Seosan' }
  ];

  try {
    let html = "";
    for (let city of cities) {
      const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city.id}&appid=${API_KEY}&units=metric`);
      const data = await response.json();
      html += `<span class="weather-tag">${city.name}</span> <strong>${Math.round(data.main.temp_min)}° / ${Math.round(data.main.temp_max)}°</strong> `;
    }
    weatherDisplay.innerHTML = html;
  } catch (e) {
    weatherDisplay.innerHTML = `날씨 정보를 가져올 수 없습니다.`;
  }
}

      async function loadUniformImage(targetDate) {
        const imgElement = document.getElementById("uniform-img");
        try {
          const res = await fetch("uniforms/uniform.csv");
          const data = await res.text();
          const rows = data.trim().split("\n");
          const match = rows.find((row) => row.startsWith(targetDate));
          if (match) {
            const fileName = match.split(",")[1].trim();
            imgElement.src = `uniforms/${fileName}`;
            imgElement.style.display = "inline-block";
          }
        } catch (e) {
          console.error("Uniform CSV Error");
        }
      }

      async function run() {
        const now = new Date();
        const hours = now.getHours();
        let displayDate = new Date(now);
        let isTomorrow = false;

        if (hours >= 18) {
          displayDate.setDate(now.getDate() + 1);
          isTomorrow = true;
        }

        const dateStr = `${displayDate.getFullYear()}-${String(displayDate.getMonth() + 1).padStart(2, "0")}-${String(displayDate.getDate()).padStart(2, "0")}`;

        // 날짜 및 배지 표시
        document.getElementById("date-text").innerText =
          `${dateStr} FUTURES SCHEDULE`;
        if (isTomorrow) {
          document.getElementById("badge-area").innerHTML =
            `<span class="tomorrow-badge">TOMORROW</span>`;
        }

        // 비동기 실행 (표 로딩 방해 안 함)
        updateWeatherOnly();
        loadUniformImage(dateStr);

        // 표 그리기
        try {
          const res = await fetch("futures.csv");
          const csvData = await res.text();
          const rows = csvData.trim().split("\n");
          let html = `<table><colgroup><col style="width: 8%;"><col style="width: 42%;"><col style="width: 8%;"><col style="width: 42%;"></colgroup>`;

          rows.forEach((row, index) => {
            const cols = row.split(",");
            html += "<tr>";
            if (index === 0) {
              html += `<td colspan="2" class="main-header center-line">${cols[0] || "투수"}</td>`;
              html += `<td colspan="2" class="main-header">${cols[2] || "야수"}</td>`;
            } else if (index === rows.length - 1) {
              html += `<td class="col-time">${cols[0] || "기타"}</td>`;
              html += `<td colspan="3" class="col-content">${cols[1] || ""}</td>`;
            } else {
              cols.forEach((col, colIndex) => {
                const isPlayerList = col.includes("선수명단");
                let cellClass = isPlayerList
                  ? "player-list-cell"
                  : colIndex % 2 === 0
                    ? "col-time"
                    : "col-content";
                html += `<td class="${cellClass} ${colIndex === 1 ? "center-line" : ""}">${col || ""}</td>`;
              });
            }
            html += "</tr>";
          });
          html += "</table>";
          document.getElementById("display").innerHTML = html;
        } catch (e) {
          document.getElementById("display").innerHTML =
            "<p>CSV 파일을 로드할 수 없습니다.</p>";
        }
      }

      run();
    </script>
  </body>
</html>
