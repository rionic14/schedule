<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>월간 스케줄 - K 에디션</title>
    <style>
      /* 폰트 설정 */
      @font-face {
        font-family: "Eagles-Bold";
        src: url("Fonts/HanwhaEagles-Regular.ttf") format("truetype");
      }
      @font-face {
        font-family: "Eagles-Gothic";
        src: url("Fonts/06HANWHAGOTHICL.TTF") format("truetype");
      }
      @font-face {
        font-family: "NotoSansJP-Bold";
        src: url("Fonts/NotoSansJP-Bold.ttf") format("truetype");
      }

      body {
        background-color: #f8f9fa;
        font-family: "Eagles-Gothic", sans-serif;
        padding: 0;
        margin: 0;
      }

      /* 헤더 영역 */
      .sticky-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgb(217, 217, 217);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .top-nav-bar {
        display: flex;
        max-width: 1400px;
        margin: 0 auto;
        padding: 10px;
        gap: 10px;
      }
      .top-nav-btn {
        flex: 1;
        text-decoration: none;
        padding: 12px 0;
        border-radius: 6px;
        text-align: center;
        font-family: "Eagles-Bold";
        font-size: 2.5rem;
        color: white;
        transition: 0.2s;
      }
      .btn-futures {
        background-color: rgb(252, 78, 0);
      }
      .btn-dev {
        background-color: rgb(28, 30, 60);
      }
      .top-nav-btn:hover {
        filter: brightness(1.2);
        transform: scale(1.01);
      }

      .days-header {
        display: flex;
        max-width: 1400px;
        margin: 0 auto;
        padding-left: 35px;
        font-family: "NotoSansJP-Bold";
        text-align: center;
      }
      .header-slot {
        flex: 1;
        padding: 12px 0;
        border-right: 1px solid #ccc;
        font-size: 1.3rem;
      }

      /* 타이틀 */
      #print-title {
        display: block;
        text-align: center;
        font-family: "Eagles-Bold";
        font-size: 3.5rem;
        color: #1c1e3c;
        padding: 20px 0;
        border-bottom: 5px solid rgb(252, 78, 0);
        max-width: 1400px;
        margin: 0 auto 20px auto;
        cursor: pointer;
      }

      /* 스케줄 그리드 */
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 10px;
      }
      .week-block {
        background: white;
        border-radius: 8px;
        margin-bottom: 25px;
        border: 1px solid #ddd;
        overflow: hidden;
      }
      .team-row {
        display: flex;
        border-bottom: 1px solid #eee;
        position: relative;
      }
      .team-label {
        width: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Eagles-Bold";
        color: white;
        font-size: 1.9rem;
        flex-shrink: 0;
      }
      .futures-row {
        background-color: #fff5f2;
      }
      .futures-label {
        background-color: rgb(252, 78, 0);
      }
      .dev-row {
        background-color: #f2f2ff;
      }
      .dev-label {
        background-color: rgb(28, 30, 60);
      }

      .day-slots {
        display: flex;
        flex-grow: 1;
        width: calc(100% - 35px);
      }
      .day-slot {
        flex: 1;
        border-right: 1px solid #eee;
        padding: 10px;
        height: 80px;
        overflow: hidden;
        cursor: pointer;
        transition: 0.2s;
      }
      .dev-row .day-slot {
        height: 55px;
      }
      .day-slot.today {
        outline: 3px solid #ff6600;
        outline-offset: -3px;
        background-color: #fff;
      }

      .date-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        margin-bottom: 5px;
      }
      .date-side-logo {
        width: 22px;
        height: 22px;
        object-fit: contain;
      }
      .date-label {
        font-size: 0.95rem;
        font-family: "NotoSansJP-Bold";
        color: #333;
      }

      .event-content {
        text-align: center;
        margin-bottom: 5px;
      }
      .event-title {
        font-weight: 800;
        font-size: 1.4rem;
        white-space: nowrap;
        overflow: hidden;
        display: block;
      }

      /* 모달 스타일 최적화 */
      #modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        backdrop-filter: blur(10px);
      }
      #modal-content {
        background: white;
        width: 80vw;
        max-width: 800px;
        max-height: 80vh;
        border-radius: 24px;
        padding: 40px;
        overflow-y: auto;
      }

      /* 모달 내부 일정 구분 */
      #modal-content .event-content {
        padding: 30px 0;
        border-bottom: 4px solid rgb(28, 30, 60);
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #modal-content .event-content:last-child {
        border-bottom: none;
      }

      /* 모달 서체 설정 */
      #modal-content .event-title {
        font-family: "NotoSansJP-Bold" !important;
        font-size: 3.2rem;
        margin-bottom: 15px;
        color: #000;
        text-align: center;
        overflow: visible;
        white-space: normal;
      }
      #modal-content .event-info {
        font-family: "Eagles-Gothic";
        font-size: 2rem;
        color: #555;
        margin-bottom: 20px;
      }
      #modal-content .event-desc {
        font-family: "Eagles-Gothic";
        font-size: 1.7rem;
        width: 90%;
        padding-top: 20px;
        border-top: 2px dashed #ffdf74;
        text-align: left;
        white-space: pre-wrap;
        line-height: 1.6;
        color: #333;
      }

      /* 텍스트 컬러 */
      .text-orange {
        color: #ff6600 !important;
      }
      .text-navy {
        color: #1c1e3c !important;
      }
      .text-red {
        color: #ff0000 !important;
      }
    </style>
  </head>
  <body>
    <div id="print-title" onclick="location.href = 'index.html'">
      퓨처스/육성군 일정표
    </div>

    <div class="sticky-header">
      <div class="top-nav-bar">
        <a href="futures.html" class="top-nav-btn btn-futures">퓨처스</a>
        <a href="development.html" class="top-nav-btn btn-dev">육성군</a>
      </div>
      <div class="days-header">
        <div class="header-slot" style="color: #ff0019">日</div>
        <div class="header-slot">月</div>
        <div class="header-slot">火</div>
        <div class="header-slot">水</div>
        <div class="header-slot">木</div>
        <div class="header-slot">金</div>
        <div class="header-slot" style="color: #2010ff">土</div>
      </div>
    </div>

    <div class="container" id="schedule-container">
      <div
        id="loading"
        style="
          text-align: center;
          padding: 100px;
          font-family: &quot;Eagles-Bold&quot;;
          font-size: 2rem;
          color: #ff6600;
        "
      >
        데이터 로딩 중...
      </div>
    </div>

    <div id="modal-overlay" onclick="closeModal()">
      <div id="modal-content" onclick="event.stopPropagation()"></div>
    </div>

    <script>
      const API_KEY = "AIzaSyAluwiwfHMYHBoAZe5EAXAiejet-s_Pwl8";
      const CALENDARS = [
        {
          id: "0e62092f3ac04d780ab1cccccb428e2119f2823be6f59112cc0e427d843a0695@group.calendar.google.com",
          name: "F",
          rowClass: "futures-row",
          labelClass: "futures-label",
        },
        {
          id: "ca9502e51d0b0bd07eaa8ab7dbbc3925b69576439b0642b072dc79015eed8d11@group.calendar.google.com",
          name: "D",
          rowClass: "dev-row",
          labelClass: "dev-label",
        },
      ];

      function openModal(slotId) {
        const slot = document.getElementById(slotId);
        const content = slot.querySelector(".slot-content").innerHTML;
        if (!content.trim()) return;
        document.getElementById("modal-content").innerHTML = content;
        document.getElementById("modal-overlay").style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function closeModal() {
        document.getElementById("modal-overlay").style.display = "none";
        document.body.style.overflow = "auto";
      }

      async function fetchEvents(calId, start) {
        const end = new Date(start);
        end.setDate(start.getDate() + 42);
        const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calId)}/events?key=${API_KEY}&timeMin=${start.toISOString()}&timeMax=${end.toISOString()}&singleEvents=true&orderBy=startTime`;
        const res = await fetch(url);
        const data = await res.json();
        return data.items || [];
      }

      function getConditionClass(text) {
        if (text.includes("휴")) return "text-red";
        if (text.includes("-한화")) return "text-orange";
        if (text.includes("한화-")) return "text-navy";
        return "";
      }

      async function renderSchedule() {
        const d = new Date();
        d.setDate(d.getDate() - d.getDay());
        d.setHours(0, 0, 0, 0);

        const [futures, dev] = await Promise.all([
          fetchEvents(CALENDARS[0].id, d),
          fetchEvents(CALENDARS[1].id, d),
        ]);
        const container = document.getElementById("schedule-container");
        container.innerHTML = "";

        for (let w = 0; w < 6; w++) {
          const weekBlock = document.createElement("div");
          weekBlock.className = "week-block";

          [futures, dev].forEach((events, idx) => {
            const cal = CALENDARS[idx];
            const row = document.createElement("div");
            row.className = `team-row ${cal.rowClass}`;
            let html = `<div class="team-label ${cal.labelClass}">${cal.name}</div><div class="day-slots">`;

            for (let i = 0; i < 7; i++) {
              const cur = new Date(d);
              cur.setDate(d.getDate() + w * 7 + i);
              const isToday =
                cur.toDateString() === new Date().toDateString() ? "today" : "";
              const dayEvents = events.filter(
                (e) =>
                  new Date(e.start.date || e.start.dateTime).toDateString() ===
                  cur.toDateString(),
              );

              let logos = { l: "", r: "" };
              if (
                idx === 0 &&
                dayEvents.length > 0 &&
                dayEvents[0].summary.includes("-")
              ) {
                const ts = dayEvents[0].summary.split("-");
                logos.l = `<img src="teams/${ts[0].trim()}.png" class="date-side-logo" onerror="this.style.display='none'">`;
                logos.r = `<img src="teams/${ts[1].trim().split(" ")[0]}.png" class="date-side-logo" onerror="this.style.display='none'">`;
              }

              html += `<div class="day-slot ${isToday}" id="slot-${idx}-${w}-${i}" onclick="openModal(this.id)">`;
              if (idx === 0)
                html += `<div class="date-wrapper">${logos.l}<span class="date-label">${cur.getMonth() + 1}/${cur.getDate()}</span>${logos.r}</div>`;
              html += `<div class="slot-content">`;
              dayEvents.forEach((e) => {
                html += `<div class="event-content ${getConditionClass(e.summary)}">
                  <span class="event-title">${e.summary}</span>
                  <span class="event-info">${e.location || ""}</span>
                  ${e.description ? `<span class="event-desc">${e.description}</span>` : ""}
                </div>`;
              });
              html += `</div></div>`;
            }
            row.innerHTML = html + `</div>`;
            weekBlock.appendChild(row);
          });
          container.appendChild(weekBlock);
        }
      }
      renderSchedule();
    </script>
  </body>
</html>
